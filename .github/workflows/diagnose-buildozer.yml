name: Diagnose Buildozer Environment

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]

jobs:
  diagnose:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Show repo files
        run: |
          echo "=== ROOT FILES ==="
          ls -la
          echo "=== .github ==="
          ls -la .github || true
          echo "=== buildozer.spec exists? ==="
          if [ -f buildozer.spec ]; then echo "FOUND buildozer.spec"; else echo "MISSING buildozer.spec"; fi

      - name: Show Python version and disk
        run: |
          python3 --version
          df -h .

      - name: Install minimal python tools (fast)
        run: |
          python3 -m pip install --upgrade pip
          pip install --user cython
          pip install --user buildozer || true
          export PATH=$PATH:$HOME/.local/bin
          buildozer --version || echo "buildozer not runnable"

      - name: Print buildozer.spec (first 200 lines)
        if: always()
        run: |
          if [ -f buildozer.spec ]; then
            echo "---- buildozer.spec ----"
            sed -n '1,200p' buildozer.spec
          else
            echo "No buildozer.spec present"
          fi
